<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Возьмём с собой | WebReference</title>
<meta charset="utf-8" />
<link rel="up" href="../diveintohtml5.html" />
<link rel="next" href="forms.html" />
<link rel="prev" href="storage.html" />
<meta name="description" content="Что такое офлайновое веб-приложение? На первый взгляд это звучит как противоречие в терминах. Веб-страница это то, что вы загружаете и отображаете, загрузка предполагает подключение к сети. Как вы можете скачивать в автономном режиме? Конечно, не можете. Но вы можете скачать, когда вы находитесь в сети. Вот как работает офлайновое приложение в HTML5. В простейшем случае офлайновое веб-приложение представляет собой список адресов — HTML, CSS, JavaScript, изображения или любые другие ресурсы. Главная страница офлайнового приложения получает этот список, вызывая манифест — текстовый файл, хранящийся на веб-сервере. Браузер, работающий с приложением, читает список адресов из файла манифеста, скачивает ресурсы, кэширует их локально и автоматически сохраняет локальные копии до момента их изменения. Когда в следующий раз вы попытаетесь получить доступ к веб-приложению без подключения к сети, браузер автоматически переключится на локальную копию." />
<link rel="canonical" href="offline.html" />
<link type="text/css" rel="stylesheet" href="../../assets/css/css_GmPV_e3YNAzxsGyZNJb8l3jyzuLiXRRwUYoy5enMRkM.css" media="all" />
<link type="text/css" rel="stylesheet" href="../../assets/css/css_2H3Dgnhk-GMIhlAAevncWEQeqNkZ7SjzqGb8OfLzzuU.css" media="screen" />
</head>
<body>
<main>
<div class="off-canvas-wrap" data-offcanvas><div class="inner-wrap"><header><div class="row"><div class="small-12 large-4 columns logo"><a href="../../index.html">WebReference<span>.</span>ru</a></div><nav class="small-10 large-7 columns topmenu"><div class="region region-menu"><div id="system-main-menu" class="block"><div class="block_content"><ul class="menu"><li class="first leaf"><a href="../../ref.html" title="">Справочники</a></li><li class="leaf"><a href="../../layout.html" title="">Вёрстка</a></li><li class="leaf"><a href="../../dev.html" title="">Веб-технологии</a></li><li class="leaf"><a href="../../mobile.html" title="">Мобильные приложения</a></li><li class="last leaf"><a href="../../course.html">Курсы</a></li></ul></div></div></div></nav><div class="small-2 large-1 columns search"><div id="search-button"></div><form action="https://webref.ru/search/" id="cse-search-box"><input type="search" placeholder="Поиск по сайту" name="s" autocomplete="off" id="cse-search-input"><input type="hidden" name="cx" value="partner-pub-0708135098984815:9970767379"><input type="hidden" name="cof" value="FORID:10"><input type="hidden" name="ie" value="UTF-8"></form></div></div></header><div class="title"><div class="row"><div class="small-12 columns"><h1>Возьмём с собой</h1></div></div></div><div class="breadcrumb"><div class="row"><div class="small-12 columns"><div class="region region-crumbs"><div id="easy_breadcrumb-easy_breadcrumb" class="block"><div class="block_content"><div class="easy-breadcrumb"><a href="../../index.html" class="easy-breadcrumb_segment easy-breadcrumb_segment-front">Главная</a><span class="easy-breadcrumb_segment-separator"> / </span><a href="../../layout.html" class="easy-breadcrumb_segment easy-breadcrumb_segment-1">Вёрстка</a><span class="easy-breadcrumb_segment-separator"> / </span><a href="../diveintohtml5.html" class="easy-breadcrumb_segment easy-breadcrumb_segment-2">Погружение в HTML5</a><span class="easy-breadcrumb_segment-separator"> / </span><span class="easy-breadcrumb_segment easy-breadcrumb_segment-title">Возьмём с собой</span></div></div></div></div></div></div></div><div class="row"><div class="medium-12 large-9 columns main-section"><div class="region region-content"><div id="system-main" class="block"><p>Что такое офлайновое веб-приложение? На первый взгляд это звучит как противоречие в терминах. Веб-страница это то, что вы загружаете и отображаете, загрузка предполагает подключение к сети. Как вы можете скачивать в автономном режиме? Конечно, не можете. Но вы можете скачать, когда вы находитесь в сети. Вот как работает офлайновое приложение в HTML5.</p><p> В простейшем случае офлайновое веб-приложение представляет собой список адресов&nbsp;— HTML, CSS, JavaScript, изображения или любые другие ресурсы. Главная страница офлайнового приложения получает этот список, вызывая манифест&nbsp;— текстовый файл, хранящийся на веб-сервере. Браузер, работающий с приложением, читает список адресов из файла манифеста, скачивает ресурсы, кэширует их локально и автоматически сохраняет локальные копии до момента их изменения. Когда в следующий раз вы попытаетесь получить доступ к веб-приложению без подключения к сети, браузер автоматически переключится на локальную копию.</p><p> Отсюда начинается работа для вас, как веб-разработчика. В DOM есть флаг, который говорит, в онлайне вы или офлайне. Есть события, который происходят при изменении офлайнового статуса (сейчас вы в автономном режиме, в следующую минуту вы уже в Интернете и наоборот). Но это еще не всё. Если ваше приложение создаёт данные или сохраняет состояние, вы можете хранить информацию локально, пока вы отключены от сети, и синхронизировать её с удалённым сервером, как только возвращаетесь в онлайн. Другими словами, HTML5 позволяет перенести ваше приложение в автономный режим.</p><table class="data browser"><caption> Поддержка офлайна</caption><tr class="br"><td><span class="ie">IE</span></td><td><span class="fx">Firefox</span></td><td><span class="sa">Safari</span></td><td><span class="cr">Chrome</span></td><td><span class="op">Opera</span></td><td><span class="ip">iPhone</span></td><td><span class="an">Android</span></td></tr><tr><td><span>10.0+</span></td><td><span>3.5+</span></td><td><span>4.0+</span></td><td><span>5.0+</span></td><td><span>11.5+</span></td><td><span>3.2+</span></td><td><span>2.1+</span></td></tr></table><h2>Манифест кэша</h2><p>Офлайновое веб-приложение вращается вокруг файла манифеста кэша. Что это за файл манифеста? Это список всех ресурсов требуемых вашему веб-приложению, пока оно отключено от сети. Для загрузки и кэширования этих ресурсов вы должны указать файл манифеста с помощью атрибута <span class="attribute">manifest</span> у элемента <span class="tag">&lt;html&gt;</span>.</p>

<pre><code data-language="html">&lt;!DOCTYPE HTML&gt;
&lt;html <mark>manifest=&quot;/cache.manifest&quot;</mark>&gt;
&lt;body&gt;
  ...
&lt;/body&gt;
&lt;/html&gt;</code></pre>

<p>Ваш файл манифеста кэша может располагаться в любом месте веб-сервера, но вы должны обеспечить для него тип <span class="value">text/cache-manifest</span>. Если вы запускаете веб-сервер под Apache, то можете добавить директиву <span class="var">AddType</span> в файл .htaccess в корне сайта. </p>
<pre><code>AddType text/cache-manifest .manifest</code></pre>
<p>Убедитесь, что имя вашего файла манифеста заканчивается на .manifest. Если вы используете другой веб-сервер или конфигурацию Apache, посмотрите документацию по управлению заголовком Content-Type.</p><div class="profmarkup"><h4>Спроси профессора Разметкина</h4><div class="inner"><p><span class=q>☞</span>В. Моё веб-приложение содержит более одной страницы. Нужно ли указывать атрибут <span class="attribute">manifest</span> на каждой странице или добавить его только на главную?</p><p>О. На каждой странице вашего приложения нужен атрибут <span class="attribute">manifest</span>, который указывает на манифест кэша всего веб-приложения.</p></div></div><p>Итак, каждая из ваших HTML-страниц указывает на файл манифеста кэша, сам файл передаётся с правильным заголовком Content-Type. Но что происходит в файле манифеста? Здесь все намного интереснее.</p><p> Первая строка каждого файла манифеста заключается в следующем.</p>
<pre><code>CACHE MANIFEST</code></pre>
<p>После чего все файлы манифеста можно поделить на три раздела: «явный»,  «резервный» и «онлайновый белый список». Каждый раздел имеет заголовок на отдельной строке. Если файл манифеста не имеет никаких заголовков раздела, все перечисленные ресурсы подразумеваются в разделе «явный». Постарайтесь не зацикливаться на терминологии, иначе голова взорвётся.</p><p> Вот корректный файл манифеста. В нем перечислены три ресурса: CSS-файл, файл JavaScript и изображение в формате JPEG.</p>

<pre><code>CACHE MANIFEST
/clock.css
/clock.js
/clock-face.jpg</code></pre>

<p>Этот файл манифеста кэша не имеет заголовков, так что все перечисленные ресурсы по умолчанию находятся в разделе «явный». Ресурсы в этом разделе скачиваются и кэшируются локально и будут использоваться вместо онлайновых копий при отключении от сети. Таким образом, при загрузке этого файла манифеста, ваш браузер скачает clock.css, clock.js и clock-face.jpg в корневой директории веб-сервера. Теперь вы можете отсоединить сетевой кабель и обновить страницу, все эти ресурсы будут доступны в офлайне.</p><div class="profmarkup"><h4>Спроси профессора Разметкина</h4><div class="inner"><p><span class=q>☞</span>В. Нужно ли мне перечислять мои HTML-страницы в манифесте кэша?</p><p> О. Да и нет. Если ваше веб-приложение целиком содержится в одной странице, просто убедитесь, что страница указывает на манифест кэша с помощью атрибута <span class="attribute">manifest</span>. Когда вы переходите на HTML- страницу с атрибутом <span class="attribute">manifest</span>, сама страница считается частью веб-приложения, так что вам не нужно указывать её в файле манифеста. Однако если ваше веб-приложение содержит несколько страниц, вы должны перечислить все HTML-страницы в файле манифеста, в противном случае браузер не будет знать, что есть другие HTML-страницы, которые должны быть загружены и кэшированы.</p></div></div><h2>Раздел NETWORK</h2><p>Вот более сложный пример. Предположим, вы хотите, чтобы ваше приложение отслеживало посетителей, используя скрипт tracking.cgi, который динамически загружается из <span class="tag">&lt;img src&gt;</span>. Кэширование этого ресурса провалит отслеживание, поэтому его нельзя кэшировать и оно никогда не должно быть доступно в автономном режиме. Вот что надо сделать.</p>
<pre><code>CACHE MANIFEST
<mark>NETWORK:</mark>
<mark>/tracking.cgi</mark>
CACHE:
/clock.css
/clock.js
/clock-face.jp</code></pre>

<p>Этот файл манифеста включает заголовки разделов. Строка, отмеченная как NETWORK: это начало раздела «онлайновый белый список». Ресурсы в этом разделе никогда не кэшируются и не доступны в автономном режиме (попытка загрузить их в офлайновом режиме приведёт к ошибке). Строка, отмеченная как CACHE: это начало раздела «явный». Остальное в этом файла такое же, как в предыдущем примере. Каждый из трёх перечисленных ресурсов будет храниться в кэше и доступен в режиме офлайн.</p><h2>Раздел FALLBACK</h2><p>Существует ещё один тип раздела в файле манифеста: резервный раздел. В этом разделе вы можете определить замену для интернет-ресурсов, которые по какой-либо причине не могут быть сохранены в кэше или не кэшируются успешно. Спецификация HTML5 предлагает такой хитрый пример использования резервного раздел.</p>

<pre><code>CACHE MANIFEST
FALLBACK:
/ /offline.html
NETWORK:
*</code></pre>

<p>Что здесь происходит? Вначале рассмотрим сайт, который содержит миллионы страниц, вроде Википедии. Вы не можете загрузить сайт целиком, как бы этого не хотелось. Предположим, что вы могли бы сделать его частично доступным в офлайне. Но как вы решите, какие страницы в кэше? Примерно так: каждая просмотренная страница гипотетически доступной в офлайне Википедии будет закачана и кэширована. Кэш будет включать каждую запись энциклопедии, которую вы когда-либо посещали, каждую страницу обсуждения и каждую страницу для правок (на которой вы можете вносить изменения в запись).</p><p>Вот что этот манифест кэша делает. Пусть каждая HTML-страница (запись, страница обсуждения, страница правок, страница истории) в Википедии указывают на этот файл манифеста. При посещении любой страницы, которая указывает на манифест кэша, ваш браузер говорит: «Эй, эта страница является частью офлайнового приложения, и что я о ней знаю?». Если ваш браузер ещё ни разу не скачивал этот файл манифеста, будет создан новый офлайновый  кэш приложения (appcache), скачаны все ресурсы, перечисленные в манифесте кэша, а затем текущая страница добавлена в appcache. Если ваш браузер знает об этом манифесте кэша, он просто добавит текущую страницу в существующий кэш приложения. Так или иначе, страница, которую вы только что посетили, оказывается в кэше приложения. Это важно и означает, что вы можете иметь офлайновое веб-приложение, которое «лениво» добавляет страницы при их посещении. Вам не нужно перечислять каждую из ваших HTML-страниц в манифесте кэша.</p><p>Теперь посмотрим на раздел FALLBACK: , в этом манифесте он появляется только в одной строке. Первая часть строки (до пробела) не URL, а шаблон URL. Первый символ (/) соответствует любой странице вашего сайта, не только главной. При попытке посетить страницу, пока вы находитесь в офлайновом режиме, браузер будет искать её в кэше приложения. Если ваш браузер находит в нём страницы (потому что вы её посещали, пока были подключены к сети и страница в этот момент неявно добавляется в appcache), то ваш браузер будет отображать кэшированную копию страницы. Если ваш браузер не обнаружил страницу в кэше приложения, вместо отображения сообщения об ошибке появится страница /offline.html, указанная во второй половине строки резервного раздела.</p><p>Наконец, давайте рассмотрим раздел NETWORK:. Этот раздел в манифесте занимает одну строку, которая содержит один символ (*). Этот символ имеет особое значение в сетевом разделе, он называется «подстановочный флаг онлайнового белого списка». Это причудливый способ сказать: всё, что не в appcache, должно быть загружено по исходному веб-адресу при подключении к Интернету. Это важно для «открытых» офлайновых веб-приложений и означает, что пока вы просматриваете эту гипотетическую автономную Википедию по сети, ваш браузер будет получать изображения, видео и другие встроенные ресурсы как обычно, даже если они находятся на другом домене. Это характерно для больших сайтов, даже если они не являются частью офлайнового веб-приложений. HTML-страницы генерируются локально, в то время как изображения и видео загружаются с другого домена.</p><p>Без подстановочного флага наша гипотетическая офлайновая Википедия будет вести себя странно, когда вы в онлайне, в частности, она не будет загружать изображения или видео извне.</p><p>Является ли это пример завершённым? Нет. Википедия это больше, чем HTML-файлы. В ней используются общие CSS, JavaScript и картинки на каждой странице. Все эти ресурсы должны быть указаны в явном виде в разделе CACHE: файла манифеста, чтобы страницы в офлайне правильно отображались и обрабатывались. Но указание резервного раздела делает так, что вы имеете открытое офлайновое приложение, которое выходит за рамки тех ресурсов, что мы перечислили в явном виде в файле манифеста.</p><h2>Поток событий</h2><p>Итак, я рассказал об офлайновых веб-приложениях, манифесте кэша и автономном кэше приложения (appcache) в расплывчатых, полумагических терминах. Всякие штуки загружаются, браузеры принимают решения и всё просто работает. Вы знаете что-то лучше этого? Я имею в виду, что мы говорим про веб-разработку. Ничего так просто не работает.</p><p>Вначале давайте поговорим о потоке событий. В частности, событиях DOM. Когда ваш браузер посещает страницу, которая указывает на манифест кэша, происходит серия событий в объекте <span class="var">window.applicationCache</span>. Я знаю, что это кажется сложным, но поверьте мне, это простейший вариант, что я смог придумать и не потерять ничего важного.</p><ol><li>Как только ваш браузер замечает атрибут <span class="attribute">manifest</span> в элементе <span class="tag">&lt;html&gt;</span>, он вызывает событие <span class="var">checking</span> (все события, перечисленные здесь, срабатывают на объекте <span class="var">window.applicationCache</span>). Событие <span class="var">checking</span> всегда срабатывает, независимо от того, посещали вы эту страницу ранее или любую другую указанную в манифесте кэша.</li><li>Если ваш браузер ещё не видел манифест кэша...<ul><li>Сработает событие <span class="var">downloading</span>, затем браузер начинает загружать все ресурсы, указанные в манифесте кэша.</li><li>Пока идёт загрузка, периодически срабатывает событие <span class="var">progress</span>, которое содержит информацию, сколько файлов было скачано и сколько ещё в очереди загрузки.</li><li>После того, как все перечисленные в манифесте ресурсы были успешно загружены, в браузере срабатывает финальное событие <span class="var">cached</span>. Это сигнал для вас, что офлайновое приложение полностью кэшировано и готово к автономному использованию.</li></ul></li><li>С другой стороны, если вы уже посещали эту страницу или любую другую страницу, указанную в манифесте кэша, то ваш браузер уже знает об этом манифесте. Так что некоторые ресурсы возможно уже имеются в appcache или даже рабочее приложение целиком. Так что теперь вопрос в том, изменился ли кэш с момента последнего посещения браузером и как это проверить?<ul><li>Если ответ отрицательный, то манифест кэша не изменился, браузер немедленно вызовет событие <span class="var">noupdate</span>. Вот и всё.</li><li>Если ответ «да», манифест кэша изменился, браузер вызовет событие <span class="var">downloading</span> и начнёт повторно загружать каждый ресурс, упомянутый в манифесте.</li><li>Пока идёт загрузка, браузер периодически вызывает событие <span class="var">progress</span>, которое содержит информацию, сколько файлов было скачано и сколько ещё в очереди загрузки.</li><li>После того, как все ресурсы, перечисленные в манифесте кэша, были успешно загружены вновь, в браузере срабатывает заключительное событие <span class="var">updateready</span>. Это сигнал, что новая версия офлайнового веб-приложения полностью кэширована и готова к автономному использованию. Однако, новая версия ещё не используется. Для «горячей замены» на новую версию без вынуждения пользователя перезагрузить страницу, вы можете вручную вызвать функцию <span class="var">window.applicationCache.swapCache()</span>.</li></ul></li></ol><p>Если в любой момент в этом процессе что-то пойдёт не так, ваш браузер вызовет событие <span class="var">error</span> и остановится. Вот очень сокращённый список вещей, которые могут привести к неприятностям.</p><ul><li>манифест кэша возвращает HTTP-ошибку 404 (страница не найдена) или 410 (страница перенесена постоянно).</li><li>манифест кэша был найден и не изменился, но HTML-страницы указанные в манифесте не удалось загрузить правильно.</li><li>манифест кэша изменился, пока было запущено обновление.</li><li>манифест кэша был найден и не изменился, но браузеру не удалось загрузить один из ресурсов, перечисленных в нём.</li></ul><div id="block-17" class="block"><div class="block_content">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-0708135098984815" data-ad-slot="1599783371" data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div><h2>Искусство отладки или «Убей меня! Убей меня сейчас!»</h2><p>Я хочу отметить здесь два важных момента. Первый вы только что прочитали, но держу пари, не осознали, поэтому ещё раз: если хотя бы один ресурс, упомянутый в файле манифеста, не будет скачан правильно, весь процесс кэширования вашего офлайнового приложения провалится. Ваш браузер будет вызывать событие <span class="var">error</span>, но не сообщает, в чём состоит проблема. Это может сделать отладку офлайнового веб-приложения ужаснее, чем обычно.</p><p>Второй важный момент не связан, технически говоря, с ошибкой, но будет выглядеть как серьёзная ошибка браузера, пока вы не поймёте, что происходит. Связано это с тем, как браузер проверяет, что файл манифеста кэша изменился. Это трёхэтапный процесс, хотя он скучен, но важен, так что будьте внимательны.</p><ol><li>Посредством HTTP-семантики ваш браузер проверяет, что срок действия манифеста кэша истек. Так же, как и любой другой файл, работающий через HTTP, веб-сервер, как правило, включает мета-информацию о файле в HTTP-заголовок ответа. Некоторые из этих HTTP-заголовков (Expires и Cache-Control) говорят браузеру, как ему кэшировать файлы без всякого запроса сервера. Этот вид кэширования не имеет ничего общего с офлайновым веб-приложением и происходит практически со всеми HTML-страницами, таблицами стилей, скриптами, изображениями или другими ресурсами в Интернете.</li><li>Если срок манифеста кэша истёк (в соответствии с его HTTP-заголовком), то ваш браузер запрашивает сервер, есть ли новая версия, и если да, то браузер скачает её. Для этого ваш браузер отправит HTTP-запрос, который включает дату последнего изменения манифеста кэша. Если веб-сервер определяет, что файл манифеста не поменялся с того времени, он просто вернёт статус 304 (не изменён). Опять же это не относится к офлайновым веб-приложениям. Это происходит по существу со всеми ресурсами в Интернете.</li><li>Если веб-сервер считает, что файл манифеста изменился с того времени, он вернёт код состояния 200 (всё в порядке), отправит содержимое нового файла с новым заголовком Cache-Control и датой последнего изменения, так что шаги 1 и 2 в следующий раз будут работать правильно. HTTP крут; веб-серверы всегда планируют на будущее и если вашему веб-серверу необходимо отправить вам файл, он сделает всё возможное, чтобы не отправлять его дважды без всякой причины. Как только скачан новый файл манифеста кэша, ваш браузер будет сравнивать содержимое с копией скачанной ранее. Если содержимое файла манифеста кэша такое же, каким оно было в последний раз, браузер не станет повторно загружать любой из ресурсов, перечисленных в манифесте.</li></ol><p>Любой из этих шагов может сбить вас с толку, пока вы разрабатываете и тестируете ваше офлайновое веб-приложение. Например, у вас используется одна версия файла манифеста кэша, через 10 минут вы понимаете, что нужно добавить ещё один ресурс. Не проблема, верно? Просто добавьте ещё одну строку. Бдыщь. Вот что случится: вы обновите страницу, браузер обнаружит атрибут <span class="attribute">manifest</span>, сработает событие <span class="var">checking</span>, а затем... ничего. Ваш браузер упорно настаивает на том, что файл манифеста не изменился. Почему? Потому что ваш веб-сервер, скорее всего, по умолчанию настроен сообщать браузеру кэшировать статичные файлы в течение нескольких часов (используя HTTP-заголовок Cache-Control). Это означает, что браузер никогда не пройдёт первый шаг этого трёхэтапного процесса. Конечно, веб-сервер знает, что файл был изменён, но ваш браузер даже не догадается спросить об этом сервер. Почему? Потому что в последний раз ваш браузер скачал манифест кэша, веб-сервер сказал ему кэшировать ресурсы несколько часов (используюя HTTP-заголовок Cache-Control). И теперь, спустя 10&nbsp;минут, браузер так и делает.</p><p>Для ясности, это не баг, это фича. Все работаёт именно так, как и предполагалось. Если у веб-сервера нет способа сказать браузерам (и промежуточным прокси) про кэширование, Интернет лопнет в одночасье. Но это не успокоит после того, как вы потратите несколько часов, пытаясь выяснить, почему ваш браузер не заметил обновлённый манифест кэша. Ещё лучше, если вы ждали достаточно долго и всё таинственным образом заработает снова! Потому что срок кэша истёк! Так, как и должно быть! Убей меня! Убей меня сейчас!</p><p>Так вот одну вещь вы должны сделать точно: перенастроить ваш веб-сервер так, чтобы файл манифеста не кэшировался по HTTP. Если вы используете Apache в качестве веб-сервера, эти две строки в вашем файле .htaccess сделают своё дело.</p>

<pre><code>ExpiresActive On
ExpiresDefault &quot;access&quot;</code></pre>

<p>Фактически это отключит кэширование для всех файлов в этом каталоге и всех подкаталогах. Вероятно это не то, что вы хотели бы в действительности, так что вы должны либо связать строки с директивой &lt;Files&gt;, чтобы влиять только на файл манифеста, либо создать подкаталог, который содержит только .htaccess и файл манифеста. Как обычно, сведения о конфигурации зависят от веб-сервера, поэтому обратитесь к его документации о том, как управлять HTTP-заголовками кэширования.</p><p> Как только вы отключите HTTP-кэширование для файла манифеста, у вас ещё будет время изменить один из ресурсов в appcache, но по тому же адресу на сервере. И вот здесь шаг&nbsp;2 из трехэтапного процесса покажет вам. Если файл манифеста не изменился, браузер никогда не заметит, что один из ранее кэшированных ресурсов изменился. Рассмотрим следующий пример.</p>

<pre><code>CACHE MANIFEST
# rev 42
clock.js
clock.css</code></pre>

<p>Если вы измените clock.css, то не увидите изменений, потому что файл манифеста не поменялся. Каждый раз, когда вы вносите модификацию в один из ресурсов вашего офлайнового веб-приложения, вам необходимо менять и сам файл манифеста. Это может быть всего лишь замена одного символа. Я обнаружил простой метод&nbsp;— это включить комментарий с номером ревизии. Меняем номер ревизии в комментарии и веб-сервер возвращает новый изменённый файл манифеста. Браузер замечает, что содержимое файла изменилось и запустит процесс повторной закачки всех ресурсов перечисленных в манифесте.</p>
<pre><code>CACHE MANIFEST
<mark># rev 43</mark>
clock.js
clock.css</code></pre>
<h2>Давайте построим одно!</h2><p>Помните игру Уголки, которая была представлена в главе про холст, а затем улучшена за счёт сохранения состояния в локальном хранилище? Давайте перенесём Уголки в офлайн.</p><p>Чтобы сделать это, нам нужно составить список всех ресурсов этой игры. Итак, есть главная HTML-страница, один файл JavaScript, содержащий весь код игры, и... всё. Картинок нет, потому что всё рисуется программно через API Canvas. Все необходимые стили находятся внутри <span class="tag">&lt;style&gt;</span> в верхней части страницы. Вот наш манифест кэша.</p>
<pre><code>CACHE MANIFEST
halma.html
../halma-localstorage.js</code></pre>

<p>Несколько слов о путях. Внутри каталога examples я создал подкаталог offline и файл манифеста живёт в нём. Из-за того, что HTML-страницам необходимо одно небольшое дополнение для работы в офлайне (об этом чуть позже) я создал отдельную копию HTML-файла, который также живет внутри offline. Поскольку нет никаких изменений в коде JavaScript, я повторно использую тот же файл .js, который хранится в родительском каталоге (examples). Все файлы выглядят следующим образом.</p>

<pre><code>/examples/localstorage-halma.html
/examples/halma-localstorage.js
/examples/offline/halma.manifest
/examples/offline/halma.html</code></pre>

<p>В файле манифеста (/examples/offline/halma.manifest) мы хотим указать два файла. Во-первых, офлайновую версию HTML-файла (/examples/offline/halma.html). Поскольку эти файлы хранятся в одном каталоге, они указаны в файле манифеста без каких-либо префиксов пути. Во-вторых, файл JavaScript, который живёт в родительском каталоге (/examples/halma-localstorage.js). Перечисление в файле манифеста включает относительный путь: ../halma-localstorage.js. Это похоже на использование относительных путей в атрибуте <span class="attribute">src</span> элемента <span class="tag">&lt;img&gt;</span>. Как вы увидите в следующем примере, вы также можете использовать абсолютные пути (которые начинаются с корня текущего домена) или даже абсолютный адреса (которые указывают на ресурсы других доменов).</p><p> Теперь в HTML-файл мы должны добавить атрибут <span class="attribute">manifest</span>, который указывает на файл манифеста кэша.</p>
  
<pre><code data-language="html">&lt;!DOCTYPE html&gt;
&lt;html <mark>manifest=&quot;halma.manifest&quot;</mark>&gt;</code></pre>

<p>Вот и всё! Когда браузер, способный на работу офлайн, загрузит первый раз <a href="https://webref.ru/example/offline/">страницу с поддержкой офлайн</a>, он скачивает указанный файл манифеста и начинает загрузку всех упомянутых ресурсов, сохраняя их в автономном кэше приложения. Вы можете играть в игру в офлайне и локально сохранять её состояние.</p><h2>Дальнейшее чтение</h2><p>Стандарты:</p><ul><li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/offline.html" hreflang="en">Offline web applications</a> в спецификации HTML5</li></ul><p>Документация от разработчиков браузеров:</p><ul><li><a href="http://developer.mozilla.org/En/Offline_resources_in_Firefox" hreflang="en">Offline resources in Firefox</a></li><li><a href="http://developer.apple.com/safari/library/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/OfflineApplicationCache/OfflineApplicationCache.html" hreflang="en">HTML5 offline application cache</a>, часть <a href="http://developer.apple.com/safari/library/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/Introduction/Introduction.html" hreflang="en">Safari client-side storage and offline applications programming guide</a></li></ul><p>Учебники и демонстрации:</p><ul><li><a href="http://googlecode.blogspot.com/2009/04/gmail-for-mobile-html5-series-using.html" hreflang="en">Gmail for mobile HTML5 series: using appcache to launch offline - part 1</a></li><li><a href="http://googlecode.blogspot.com/2009/05/gmail-for-mobile-html5-series-part-2.html" hreflang="en">Gmail for mobile HTML5 series: using appcache to launch offline - part 2</a></li><li><a href="http://googlecode.blogspot.com/2009/05/gmail-for-mobile-html5-series-part-3.html" hreflang="en">Gmail for mobile HTML5 series: using appcache to launch offline - part 3</a></li><li><a href="http://jonathanstark.com/blog/2009/09/27/debugging-html-5-offline-application-cache/" hreflang="en">Debugging HTML5 offline application cache</a></li><li><a href="http://hacks.mozilla.org/2010/02/an-html5-offline-image-editor-and-uploader-application/" hreflang="en">an HTML5 offline image editor and uploader application</a></li><li><a href="http://www.20thingsilearned.com/" hreflang="en">20 Things I Learned About Browsers and the Web</a></li></ul><p>Инструменты для работы с манифестом кэша:</p><ul><li><a href="http://manifest-validator.com/">Cache Manifest Validator</a>, онлайновый сервис для валидации манифеста</li><li><a href="http://manifesto.ericdelabar.com/">Manifesto</a>, букмарклет для валидации</li></ul><section class="row credit"><div class="columns small-6 credit-author"><i class="icon-user"></i> Автор: Марк Пилгрим</div><div class="columns small-6 credit-changed"><i class="icon-calendar"></i> Последнее изменение: 25.08.2015</div><div class="columns small-12 credit-editor"><i class="icon-users"></i> Редакторы: Клим Щербаков</div></section><script src="../../sites/all/themes/ori/js/mousetrap.min.js"></script>
<script>
Mousetrap.bind('mod+left', function()   { document.location ='/layout/diveintohtml5/storage'; });Mousetrap.bind('mod+right', function() { document.location = '/layout/diveintohtml5/forms'; });</script>
<div class="book-navigation row" id="book-navigation-bottom"><div class="small-6 columns page-previous"><a href="storage.html" title="На предыдущую страницу">Локальное хранилище</a><br><span class="navigation-tooltip"><kbd>Ctrl</kbd>+<kbd>←</kbd></span></div><div class="small-6 columns page-next"><a href="forms.html" title="На следующую страницу">Сумасшедшие формы</a><br><span class="navigation-tooltip"><kbd>Ctrl</kbd>+<kbd>→</kbd></span></div></div><div id="block-9" class="block"><div class="block_content">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
ad = document.getElementById('block-9');
if (ad.getBoundingClientRect().width) {
adWidth = ad.getBoundingClientRect().width;
} else {
adWidth = ad.offsetWidth;
}
google_ad_client = "ca-pub-0708135098984815";
if (adWidth >= 728) { google_ad_size = ["728", "90"]; google_ad_slot = "1258944978"; }
else { google_ad_size = ["300", "250"]; google_ad_slot = "8016056172"; }
document.write (
'<ins class="adsbygoogle" style="display:inline-block;width:'
+ google_ad_size[0] + 'px;height:'
+ google_ad_size[1] + 'px" data-ad-client="'
+ google_ad_client + '" data-ad-slot="'
+ google_ad_slot + '"></ins>'
);
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div><div id="block-10" class="block"><div class="block_content"><div id="disqus_thread"></div>
<script>
var disqus_shortname = "webref";
(function() {
var dsq = document.createElement("script"); dsq.type = "text/javascript"; dsq.async = true;
dsq.src = "//" + disqus_shortname + ".disqus.com/embed.js";
(document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0]).appendChild(dsq);
})();
</script>
</div></div></div></div></div><aside class="large-3 columns right-off-canvas-menu"><div class="region region-sidebar-toc"><div id="book-navigation" class="block"><h2 class="block_title">Содержание</h2><div class="block_content"><ul class="menu"><li class="first leaf"><a href="introduction.html">Пять вещей, которые надо знать об HTML5</a></li><li class="leaf"><a href="past.html">Довольно предвзятая история HTML5</a></li><li class="leaf"><a href="detect.html">Проверка технологий HTML5</a></li><li class="leaf"><a href="semantics.html">Что всё это значит?</a></li><li class="leaf"><a href="canvas.html">Давайте порисуем</a></li><li class="leaf"><a href="video.html">Видео на сайте</a></li><li class="leaf"><a href="geolocation.html">Вы здесь</a></li><li class="leaf"><a href="storage.html">Локальное хранилище</a></li><li class="leaf active-trail"><a href="offline.html" class="active-trail active">Возьмём с собой</a></li><li class="leaf"><a href="forms.html">Сумасшедшие формы</a></li><li class="leaf"><a href="extensibility.html">Микроданные</a></li><li class="last leaf"><a href="history.html">Управление историей для пользы и развлечения</a></li></ul></div></div><div id="block-12" class="block"><div class="block_content">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:inline-block;width:200px;height:200px" data-ad-client="ca-pub-0708135098984815" data-ad-slot="4025987772"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div></div></aside></div><div class="adv_footer"><div class="row"><div class="medium-12 hide-for-medium-down"><div class="region region-adv-footer"><div id="block-15" class="block"><div class="block_content">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
ad = document.getElementById('block-15');
if (ad.getBoundingClientRect().width) {
adWidth = ad.getBoundingClientRect().width;
} else {
adWidth = ad.offsetWidth;
}
google_ad_client = "ca-pub-0708135098984815";
if (adWidth >= 728) { google_ad_size = ["728", "90"]; google_ad_slot = "1258944978"; }
else { google_ad_size = ["300", "250"]; google_ad_slot = "8016056172"; }
document.write (
'<ins class="adsbygoogle" style="display:inline-block;width:'
+ google_ad_size[0] + 'px;height:'
+ google_ad_size[1] + 'px" data-ad-client="'
+ google_ad_client + '" data-ad-slot="'
+ google_ad_slot + '"></ins>'
);
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div></div></div></div></div></div><a class="exit-off-canvas"></a></div></div><div class="copyright"><div class="row"><div class="small-2 columns"><p><a href="http://creativecommons.org/licenses/by-nc/4.0/deed.ru" rel="nofollow"><img alt="Лицензия Creative Commons" src="../../sites/all/themes/ori/img/cc.png" width="88" height="31"></a></p></div><div class="small-10 columns"><p>Все материалы сайта доступны по <a href="http://creativecommons.org/licenses/by-nc/4.0/deed.ru" rel="nofollow">лицензии Creative Commons «Attribution-NonCommercial» («Атрибуция — Некоммерческое использование») 4.0 Всемирная</a>, если не указано иное.</p></div></div></div><footer><div class="row"><div class="medium-12 large-4 columns"><h4>О сайте</h4><p>На сайте находятся справочники по различным веб-технологиям, а также руководства по вёрстке веб-страниц и разработке мобильных приложений.</p><p class="about-last">Главный редактор: Влад Мержевич</p></div><div class="small-6 large-2 columns"><h4>Связи</h4><ul id="community"><li><i class="icon-rss"></i> <a href="https://feeds.feedburner.com/webref" rel="nofollow">RSS</a></li><li><i class="icon-jsfiddle"></i> <a href="https://jsfiddle.net/user/webref/fiddles/" rel="nofollow">JSFiddle</a></li><li><i class="icon-github"></i> <a href="https://github.com/webref" rel="nofollow">GitHub</a></li><li><i class="icon-vk"></i> <a href="https://vk.com/webref" rel="nofollow">ВКонтакте</a></li><li><i class="icon-doc-text"></i> <a href="https://drive.google.com/folderview?id=0B4u62HGG7TOnTVJ4aFlFa1Jpb2M" rel="nofollow">Google Диск</a></li></ul></div><div class="small-6 large-3 columns"><h4>Разделы сайта</h4><ul id="footer-menu" class="links"><li><i class="icon-book"></i> <a href="../../ref.html">Справочники</a></li><li><i class="icon-layout"></i> <a href="../../layout.html">Вёрстка</a></li><li><i class="icon-gear"></i> <a href="../../dev.html">Веб-технологии</a></li><li><i class="icon-mobile"></i> <a href="../../mobile.html">Мобильные приложения</a></li><li><i class="icon-bookmark"></i> <a href="../../course.html">Учебные курсы</a></li></ul></div><div class="small-12 medium-12 large-3 columns"><h4>Популярные материалы</h4><div class="region region-popular"><div id="views-popular-popular" class="block"><div class="block_content"><div class="view view-popular view-id-popular view-display-id-popular view-dom-id-879c954f707d4dc3bbb41d8733499386"><div class="view-content"><ul><li class="leaf"> <img class="svg-img size-icon" data-src="/assets/svgimg/icon/img-styles/images/thumb/html5.svg.png" src="../../assets/images/thumb/html5.svg" width="16" height="16" alt="" /> <a href="../learn-html-css.html">Уроки по HTML и CSS</a></li><li class="leaf"> <img class="svg-img size-icon" data-src="/assets/svgimg/icon/img-styles/images/thumb/html5.svg.png" src="../../assets/images/thumb/html5.svg" width="16" height="16" alt="" /> <a href="../howtocodeinhtml.html">Как верстать на HTML5 и CSS3</a></li><li class="leaf"> <img class="svg-img size-icon" data-src="/assets/svgimg/icon/img-styles/images/thumb/html5.svg.png" src="../../assets/images/thumb/html5.svg" width="16" height="16" alt="" /> <a href="../html5-css3.html">HTML5 и CSS3 на примерах</a></li><li class="leaf"> <img class="svg-img size-icon" data-src="/assets/svgimg/icon/img-styles/images/thumb/css3.svg.png" src="../../assets/images/thumb/css3.svg" width="16" height="16" alt="" /> <a href="../magic-of-css.html">Магия CSS</a></li><li class="leaf"> <img class="svg-img size-icon" data-src="/assets/svgimg/icon/img-styles/images/thumb/jquery.svg.png" src="../../assets/images/thumb/jquery.svg" width="16" height="16" alt="" /> <a href="../../dev/jqfundamentals.html">Основы jQuery</a></li></ul></div></div></div></div></div></div></div><div class="row"><div class="small-12 columns counter">
<script src="../../sites/all/themes/ori/js/li.js"></script>
</div></div><a href="offline.html#top"><div class="row"><div class="small-12 columns ontop">Наверх</div></div></a></footer></main>	
<script type="text/javascript" src="../../assets/js/js_cDfSr2FXPXcK1gvn1bGJotjGggYy9AyIYPQ5Hw_Sx7s.js"></script>
<script type="text/javascript" src="../../assets/js/js_H7q2xORKmR9AN8Qx5spKEIBp7R_wG2apAswJoCUZY7I.js"></script>
<script type="text/javascript" src="../../assets/js/js_Xmre84srNMv9IsL3EsmaMioO7AzocdnCMpWwTIu-jp8.js"></script>
<script type="text/javascript" src="../../assets/js/js_WCzLp6JdBrd-C4nO79XBCCg40n8pNJ8KLyzqGIFUryg.js"></script>
</body>
</html>